<!doctype html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>角色侧面头像识别 · 校准与BP</title>
    <link rel="stylesheet" href="/css/app.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="container">
        <h1>角色侧面头像识别</h1>
        <p class="subtitle">整屏截图校准 → 上传即识别 → 本轮结果 → BP 校验与修正</p>
      </div>
    </header>

    <main class="container">
      <section class="panel">
        <div class="toolbar">
          <div class="group">
            <label class="file">
              <input type="file" id="file" accept="image/*" />
              <span>上传整屏截图（或直接 Ctrl+V）</span>
            </label>
          </div>
          <div class="group">
            <button id="openCalibrate" class="ghost">打开校准</button>
            <button id="resetRecords" class="danger">重置记录</button>
          </div>
        </div>
        <p class="hint">上传图片后将直接按“已保存的校准”裁剪 4 张头像并识别。首次使用请先完成校准，并在弹窗中选择“我是谁(P)”与“BP模式”。</p>
      </section>

      <section class="panel">
        <h3>本轮结果</h3>
        <div id="roundTip" class="muted"></div>
        <div class="slots" id="roundSlots"></div>
        <h3 style="margin-top:16px">接口输出</h3>
        <pre id="out" class="log">等待上传...</pre>
      </section>

      <!-- 角色选择器 Modal -->
      <div id="picker" class="modal">
        <div class="dialog">
          <div class="picker-controls">
            <input type="text" id="searchInput" placeholder="搜索角色（支持拼音首字母：lxz→旅行者）" />
            <div class="chips" id="eleChips"></div>
            <div class="chips" id="wpnChips"></div>
            <button id="closePicker">关闭</button>
          </div>
          <div id="pickerGrid" class="grid"></div>
        </div>
      </div>

      <!-- 设置弹窗（我是谁 + BP模式） -->
      <div id="settingsModal" class="modal">
        <div class="dialog">
          <h3>开始前先选择</h3>
          <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:10px;">
            <label>我是谁（P）：
              <select id="myPSelect">
                <option value="">请选择</option>
                <option value="1">1P</option>
                <option value="2">2P</option>
                <option value="3">3P</option>
                <option value="4">4P</option>
              </select>
            </label>
            <label><input type="radio" name="bpMode" value="personal" /> 个人BP</label>
            <label><input type="radio" name="bpMode" value="global" /> 全局BP</label>
          </div>
          <div style="display:flex; gap:8px; justify-content:flex-end;">
            <button id="saveSettings" class="primary">保存</button>
            <button id="closeSettings">取消</button>
          </div>
        </div>
      </div>

      <!-- 校准弹窗（含画布与框） -->
      <div id="calibModal" class="modal">
        <div class="dialog">
          <h3>位置校准</h3>
          <p class="hint">请选择一张整屏截图进行校准，拖动/缩放 4 个框覆盖头像，点击保存后生效。</p>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px;">
            <label class="file"><input type="file" id="calibFile" accept="image/*" /><span>选择校准截图</span></label>
            <button id="saveCalib" class="primary">保存校准</button>
            <button id="clearCalib" class="ghost">清除校准</button>
            <button id="closeCalib">关闭</button>
          </div>
          <div id="canvasWrap" class="hidden">
            <img id="imgPrev" src="" alt="预览" />
            <div class="rect" data-idx="0"><span class="badge">1</span><div class="handle nw"></div><div class="handle ne"></div><div class="handle sw"></div><div class="handle se"></div></div>
            <div class="rect" data-idx="1"><span class="badge">2</span><div class="handle nw"></div><div class="handle ne"></div><div class="handle sw"></div><div class="handle se"></div></div>
            <div class="rect" data-idx="2"><span class="badge">3</span><div class="handle nw"></div><div class="handle ne"></div><div class="handle sw"></div><div class="handle se"></div></div>
            <div class="rect" data-idx="3"><span class="badge">4</span><div class="handle nw"></div><div class="handle ne"></div><div class="handle sw"></div><div class="handle se"></div></div>
          </div>
        </div>
      </div>
    </main>

    <script src="/characters.js"></script>
    <script src="/js/app.js"></script>
  </body>
</html>
